<?xml version="1.0"?>

<project name="Example phing deploy" default="build" basedir="." description="This is an example buildfile for app.">

    <property name="dirName" value="" />
    <property name="websiteUrl" value="" />

    <property name="fullPath" value="/var/www/${dirName}" />

    <target name="makeConfigs">
        <echo msg="Copying website config, updating application urls..." />
        <copy todir="${fullPath}/config"  overwrite="true">
            <fileset dir="${project.basedir}/production">
                <include name="website.php" />
                <include name="app.php" />
            </fileset>
            <filterchain>
                <replaceregexp>
                    <regexp pattern="'url' => ''" replace="'url' => '${websiteUrl}'" />
                    <regexp pattern="'APP_URL', ''" replace="'APP_URL', '${websiteUrl}'" />
                </replaceregexp>
            </filterchain>
        </copy>
    </target>


    <target name="makeView">
        <echo msg="Copying default view..." />
        <copy todir="${fullPath}/resources/views/"  overwrite="true">
            <fileset dir="${project.basedir}/production">
                <include name="welcome.blade.php" />
            </fileset>
        </copy>
    </target>

    <target name="composerInstall">
        <echo msg="Run composer install..." />
        <exec dir="/var/www/" command="composer create-project --prefer-dist laravel/laravel ${dirName}" checkreturn="true" passthru="true"/>
    </target>

    <target name="build" depends="composerInstall, makeConfigs, makeView">
    </target>
</project>
